.PHONY: run run-mdns run-etcd build clean help

GOCMD=go
GOBUILD=$(GOCMD) build
GORUN=$(GOCMD) run

ETCD_ADDRESS?=localhost:2379

run-mdns:
	@echo "ğŸš€ Starting catalog service with mDNS registry..."
	$(GORUN) ./cmd/server/main.go --registry=mdns

run-etcd:
	@echo "ğŸš€ Starting catalog service with etcd registry ($(ETCD_ADDRESS))..."
	$(GORUN) ./cmd/server/main.go --registry=etcd --registry_address=$(ETCD_ADDRESS)

run: run-mdns

build:
	@echo "ğŸ”¨ Building catalog service..."
	$(GOBUILD) -o ../../bin/catalog ./cmd/server/main.go
	@echo "âœ… Build complete!"

clean:
	@echo "ğŸ§¹ Cleaning..."
	rm -f ../../bin/catalog

help:
	@echo "ğŸ“‹ Available targets:"
	@echo "  run-mdns  - ğŸ  Run with mDNS registry (local development)"
	@echo "  run-etcd  - ğŸŒ Run with etcd registry (default: localhost:2379)"
	@echo "              Use ETCD_ADDRESS=host:port to specify custom address"
	@echo "  run       - ğŸ  Alias for run-mdns"
	@echo "  build     - ğŸ”¨ Build catalog binary"
	@echo "  clean     - ğŸ§¹ Remove built binary"
	@echo ""
	@echo "ğŸ“ Examples:"
	@echo "  make run-mdns"
	@echo "  make run-etcd"
	@echo "  make run-etcd ETCD_ADDRESS=192.168.1.100:2379"
