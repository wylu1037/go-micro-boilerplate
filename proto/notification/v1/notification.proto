syntax = "proto3";

package notification.v1;

option go_package = "github.com/wylu1037/go-micro-boilerplate/gen/go/notification/v1;notificationv1";

import "common/v1/pagination.proto";

// Notification service handles message delivery
service NotificationService {
  // Send notifications
  rpc SendEmail(SendEmailRequest) returns (SendResponse);
  rpc SendSMS(SendSMSRequest) returns (SendResponse);
  rpc SendPush(SendPushRequest) returns (SendResponse);

  // Template management
  rpc CreateTemplate(CreateTemplateRequest) returns (Template);
  rpc GetTemplate(GetTemplateRequest) returns (Template);
  rpc ListTemplates(ListTemplatesRequest) returns (ListTemplatesResponse);
  rpc UpdateTemplate(UpdateTemplateRequest) returns (Template);
  rpc DeleteTemplate(DeleteTemplateRequest) returns (DeleteTemplateResponse);

  // Send logs query
  rpc ListSendLogs(ListSendLogsRequest) returns (ListSendLogsResponse);
}

// Email notification
message SendEmailRequest {
  string to_email = 1;
  string template_code = 2;  // Template identifier
  map<string, string> variables = 3;  // Template variables
  string subject_override = 4;  // Optional subject override
}

// SMS notification
message SendSMSRequest {
  string to_phone = 1;
  string template_code = 2;
  map<string, string> variables = 3;
}

// Push notification
message SendPushRequest {
  string user_id = 1;
  string title = 2;
  string body = 3;
  map<string, string> data = 4;  // Extra data payload
}

message SendResponse {
  bool success = 1;
  string message_id = 2;
  string error_message = 3;
}

// Notification template
message Template {
  string template_id = 1;
  string code = 2;  // Unique code like "ORDER_CREATED", "PAYMENT_SUCCESS"
  string name = 3;
  TemplateType type = 4;
  string subject = 5;  // For email
  string content = 6;  // Template content with {{variable}} placeholders
  bool active = 7;
  common.v1.Timestamp created_at = 8;
  common.v1.Timestamp updated_at = 9;
}

enum TemplateType {
  TEMPLATE_TYPE_UNSPECIFIED = 0;
  TEMPLATE_TYPE_EMAIL = 1;
  TEMPLATE_TYPE_SMS = 2;
  TEMPLATE_TYPE_PUSH = 3;
}

message CreateTemplateRequest {
  string code = 1;
  string name = 2;
  TemplateType type = 3;
  string subject = 4;
  string content = 5;
}

message GetTemplateRequest {
  string template_id = 1;
  string code = 2;  // Alternative: lookup by code
}

message ListTemplatesRequest {
  common.v1.PaginationRequest pagination = 1;
  TemplateType type = 2;  // Optional filter
}

message ListTemplatesResponse {
  repeated Template templates = 1;
  common.v1.PaginationResponse pagination = 2;
}

message UpdateTemplateRequest {
  string template_id = 1;
  optional string name = 2;
  optional string subject = 3;
  optional string content = 4;
  optional bool active = 5;
}

message DeleteTemplateRequest {
  string template_id = 1;
}

message DeleteTemplateResponse {
  bool success = 1;
}

// Send log for auditing
message SendLog {
  string log_id = 1;
  string template_code = 2;
  TemplateType type = 3;
  string recipient = 4;  // Email/phone/user_id
  SendStatus status = 5;
  string error_message = 6;
  common.v1.Timestamp sent_at = 7;
}

enum SendStatus {
  SEND_STATUS_UNSPECIFIED = 0;
  SEND_STATUS_PENDING = 1;
  SEND_STATUS_SENT = 2;
  SEND_STATUS_DELIVERED = 3;
  SEND_STATUS_FAILED = 4;
}

message ListSendLogsRequest {
  common.v1.PaginationRequest pagination = 1;
  string recipient = 2;  // Filter by recipient
  TemplateType type = 3;  // Filter by type
  SendStatus status = 4;  // Filter by status
}

message ListSendLogsResponse {
  repeated SendLog logs = 1;
  common.v1.PaginationResponse pagination = 2;
}
